<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>The Circus of Extraordinary Things</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=IM+Fell+English+SC&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0806;
  --bg-card: rgba(14, 11, 8, 0.92);
  --text: #d4c5a9;
  --text-dim: #8a7e6a;
  --text-bright: #f0e6d0;
  --accent: #c9953c;
  --accent-glow: #e8b84a;
  --accent-dim: #8a6a2a;
  --emerald: #2a6e4e;
  --emerald-glow: #3a9e6e;
  --border: rgba(201, 149, 60, 0.25);
  --shadow: rgba(0, 0, 0, 0.7);
  --transition-speed: 0.8s;
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 16px; scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
body {
  font-family: 'Crimson Text', Georgia, serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh; min-height: 100dvh;
  overflow-x: hidden;
  line-height: 1.75;
  -webkit-font-smoothing: antialiased;
}
#particles {
  position: fixed; inset: 0;
  pointer-events: none; z-index: 1;
}
.vignette {
  position: fixed; inset: 0;
  background: radial-gradient(ellipse at center, transparent 30%, rgba(0,0,0,0.65) 100%);
  pointer-events: none; z-index: 1;
}
.grain {
  position: fixed; inset: 0;
  opacity: 0.035;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 2;
}
.room {
  position: relative; z-index: 10;
  min-height: 100vh; min-height: 100dvh;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 2rem 1.25rem;
  opacity: 0;
  transition: opacity var(--transition-speed) ease;
}
.room.active { display: flex; opacity: 1; }
.room.fade-out { opacity: 0; }
.room-title {
  font-family: 'Cinzel', serif;
  font-weight: 400;
  font-size: clamp(1.4rem, 5vw, 2.2rem);
  color: var(--accent);
  text-align: center;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 0.5rem;
  opacity: 0; transform: translateY(10px);
  animation: fadeUp 1s ease forwards 0.3s;
}
.room-subtitle {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: clamp(0.85rem, 2.5vw, 1rem);
  color: var(--text-dim);
  text-align: center;
  letter-spacing: 0.08em;
  margin-bottom: 2.5rem;
  opacity: 0;
  animation: fadeUp 1s ease forwards 0.6s;
}
.prose {
  max-width: 640px; width: 100%;
  font-size: clamp(1rem, 2.8vw, 1.15rem);
  line-height: 1.85; color: var(--text);
  text-align: left; margin-bottom: 2rem;
}
.prose p {
  margin-bottom: 1.25rem;
  opacity: 0; animation: fadeUp 0.8s ease forwards;
}
.prose p:nth-child(1) { animation-delay: 0.8s; }
.prose p:nth-child(2) { animation-delay: 1.1s; }
.prose p:nth-child(3) { animation-delay: 1.4s; }
.prose p:nth-child(4) { animation-delay: 1.7s; }
.prose p:nth-child(5) { animation-delay: 2.0s; }
.prose p:nth-child(6) { animation-delay: 2.3s; }
.prose p:nth-child(7) { animation-delay: 2.6s; }
.prose p:nth-child(8) { animation-delay: 2.9s; }
.prose p:nth-child(n+9) { animation-delay: 3.2s; }
.choices {
  display: flex; flex-direction: column;
  gap: 0.75rem; max-width: 540px; width: 100%;
  opacity: 0; animation: fadeUp 0.8s ease forwards 3s;
}
.choice-btn {
  display: block; width: 100%;
  padding: 1.1rem 1.5rem;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
  font-family: 'Crimson Text', serif;
  font-size: clamp(0.95rem, 2.5vw, 1.05rem);
  font-style: italic;
  text-align: left; line-height: 1.6;
  cursor: pointer; border-radius: 2px;
  transition: all 0.4s ease;
}
.choice-btn:hover {
  border-color: var(--accent);
  background: rgba(201, 149, 60, 0.06);
  color: var(--text-bright);
  box-shadow: 0 0 30px rgba(201, 149, 60, 0.08);
  padding-left: 1.8rem;
}
.ai-prompt-section {
  max-width: 540px; width: 100%;
  margin-top: 2rem; padding: 1.5rem;
  border: 1px solid var(--border);
  background: var(--bg-card);
  border-radius: 2px;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 1.2s ease, transform 1.2s ease;
}
.ai-prompt-section.visible {
  opacity: 1;
  transform: translateY(0);
}
.ai-prompt-section .prompt-label {
  font-family: 'IM Fell English SC', serif;
  font-size: 0.7rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--accent-dim);
  margin-bottom: 1rem;
}
.ai-prompt-section .prompt-text {
  font-family: 'Crimson Text', serif;
  font-style: italic;
  font-size: 1rem;
  line-height: 1.75;
  color: var(--text);
  margin-bottom: 1rem;
}
.ai-prompt-section .prompt-instructions p {
  font-family: 'Crimson Text', serif;
  font-size: 0.95rem;
  line-height: 1.7;
  color: var(--text);
  margin-bottom: 0.5rem;
}
.ai-prompt-section .prompt-return {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.9rem;
  color: var(--text-dim);
  border-top: 1px solid var(--border);
  padding-top: 1rem;
  margin-top: 1rem;
}
.continue-btn {
  display: inline-block; margin-top: 2rem;
  padding: 0.8rem 2.5rem;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--accent);
  font-family: 'Cinzel', serif;
  font-size: 0.75rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  cursor: pointer; border-radius: 2px;
  transition: all 0.4s ease;
  opacity: 0; animation: fadeUp 0.8s ease forwards 0.5s;
}
.continue-btn:hover {
  border-color: var(--accent);
  background: rgba(201, 149, 60, 0.08);
  box-shadow: 0 0 25px rgba(201, 149, 60, 0.1);
}
.title-card {
  max-width: 500px; width: 100%;
  text-align: center;
  padding: 2.5rem 2rem;
  border: 1px solid var(--border);
  background: var(--bg-card);
  margin: 2rem 0;
  opacity: 0;
}
.title-card .creature-name {
  font-family: 'IM Fell English SC', serif;
  font-size: clamp(0.7rem, 2vw, 0.8rem);
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 1rem;
}
.title-card .guest-title {
  font-family: 'Cinzel', serif;
  font-size: clamp(1.1rem, 3.5vw, 1.5rem);
  color: var(--accent-glow);
  line-height: 1.5;
  letter-spacing: 0.05em;
  margin-bottom: 1.5rem;
}
.action-btn {
  display: inline-block; margin: 0.5rem;
  padding: 0.9rem 2rem;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--accent);
  font-family: 'Cinzel', serif;
  font-size: 0.7rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  text-decoration: none;
  cursor: pointer; border-radius: 2px;
  transition: all 0.4s ease;
}
.action-btn:hover {
  border-color: var(--accent);
  background: rgba(201, 149, 60, 0.1);
  box-shadow: 0 0 30px rgba(201, 149, 60, 0.1);
}
.action-btn.primary {
  background: rgba(201, 149, 60, 0.12);
  border-color: var(--accent);
}
.creature-image-frame {
  max-width: 480px; width: 100%;
  margin: 2rem auto;
  border: 1px solid var(--border);
  background: var(--bg-card);
  padding: 0.5rem;
  opacity: 0;
  transition: opacity 2s ease;
}
.creature-image-frame.visible { opacity: 1; }
.creature-image-frame img {
  width: 100%; height: auto;
  display: block;
  filter: sepia(0.08) contrast(1.05);
}
.creature-reveal {
  max-width: 540px; width: 100%;
  text-align: center;
}
.creature-reveal .reveal-sentence {
  font-family: 'Crimson Text', serif;
  font-style: italic;
  font-size: 1.05rem;
  line-height: 1.8;
  color: var(--text);
  margin-bottom: 0.6rem;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 1.2s ease, transform 1.2s ease;
}
.creature-reveal .reveal-sentence.visible {
  opacity: 1;
  transform: translateY(0);
}
.actions-row {
  margin-top: 2rem; text-align: center;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 1.2s ease, transform 1.2s ease;
}
.actions-row.visible {
  opacity: 1;
  transform: translateY(0);
}
.abbey-section {
  max-width: 540px; width: 100%;
  text-align: center;
  margin-top: 1.5rem;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 1.2s ease, transform 1.2s ease;
}
.abbey-section.visible {
  opacity: 1;
  transform: translateY(0);
}
.abbey-section p {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.85rem;
  color: var(--text-dim);
  line-height: 1.7;
}
.ornament {
  text-align: center; color: var(--accent-dim);
  font-size: 1.2rem; letter-spacing: 0.5em;
  margin: 2rem 0;
  opacity: 0; animation: fadeUp 0.6s ease forwards 0.5s;
}
.ornament-line {
  display: block; width: 60px; height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-dim), transparent);
  margin: 1.5rem auto;
}
#audio-toggle {
  position: fixed; bottom: 1.5rem; right: 1.5rem;
  z-index: 100; width: 44px; height: 44px;
  border-radius: 50%;
  border: 1px solid var(--border);
  background: rgba(10, 8, 6, 0.85);
  color: var(--accent);
  font-size: 1.2rem;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.3s ease;
  opacity: 0;
  backdrop-filter: blur(8px);
}
#audio-toggle.visible { opacity: 1; }
#audio-toggle:hover {
  border-color: var(--accent);
  background: rgba(201, 149, 60, 0.1);
}
#room-clearing {
  background-image: url('clearing.png');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}
#room-clearing::before {
  content: '';
  position: absolute; inset: 0;
  background: rgba(10, 8, 6, 0.78);
  z-index: -1;
}
/* Room Cameo Vignettes */
.room-cameo {
  position: relative;
  width: clamp(260px, 65vw, 420px);
  height: clamp(180px, 45vw, 290px);
  margin: 0 auto 1.5rem;
  overflow: hidden;
  border-radius: 50%;
  opacity: 0;
  animation: cameoPulse 1.2s ease forwards 0.1s;
}
.room-cameo::after {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 50%;
  box-shadow:
    inset 0 0 40px 20px var(--bg),
    inset 0 0 80px 40px var(--bg),
    inset 0 0 120px 55px var(--bg);
  pointer-events: none;
  z-index: 2;
}
.room-cameo video,
.room-cameo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  filter: sepia(0.12) contrast(1.05) brightness(0.85);
}
.splash-cameo {
  width: clamp(300px, 80vw, 560px);
  height: clamp(210px, 55vw, 390px);
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}
.splash-cameo:hover {
  transform: scale(1.03);
}
.splash-cameo::before {
  content: '';
  position: absolute;
  inset: -1px;
  border-radius: 50%;
  border: 1px solid var(--border);
  z-index: 3;
  pointer-events: none;
  transition: border-color 0.4s ease;
}
.splash-cameo:hover::before {
  border-color: var(--accent);
}
@keyframes cameoPulse {
  0% { opacity: 0; transform: scale(0.95); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@media (max-width: 480px) {
  .room { padding: 1.5rem 1rem; }
  .choice-btn { padding: 1rem 1.1rem; }
  .title-card { padding: 1.5rem 1.25rem; }
}
@media (min-width: 768px) { .room { padding: 3rem 2rem; } }
</style>
</head>
<body>

<canvas id="particles"></canvas>
<div class="vignette"></div>
<div class="grain"></div>
<button id="audio-toggle" onclick="Audio.toggle()" title="Toggle music">&#9835;</button>

<!-- ═══════════════════════════════════════════
     SPLASH — TITLE CARD / ENTRY GATE
     ═══════════════════════════════════════════ -->
<div class="room active" id="room-splash">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo splash-cameo" id="splash-gate" onclick="enterFromSplash()" style="cursor:pointer;">
    <video autoplay loop muted playsinline>
      <source src="room-circus-exterior.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Circus of Extraordinary Things</h1>
  <p class="room-subtitle">A Wedding Reception by Kay &amp; Dax</p>
  <p class="room-subtitle" style="animation-delay: 0.9s; margin-top: -1.5rem; letter-spacing: 0.15em; font-size: clamp(0.75rem, 2vw, 0.85rem);">— Tap to enter —</p>
</div>

<!-- ═══════════════════════════════════════════
     WELCOME
     ═══════════════════════════════════════════ -->
<div class="room" id="room-welcome">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-circus-exterior.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Circus of Extraordinary Things</h1>
  <p class="room-subtitle">A Wedding Reception by Kay &amp; Dax</p>
  <div class="prose">
    <p>The tent appeared overnight. No one saw it arrive. No one heard the stakes driven into the ground or the ropes pulled taut or the pennants unfurled &mdash; but here it is, breathing in the dark like something alive and waiting.</p>
    <p>The canvas is old. Striped in colours that don&rsquo;t have names in any language you speak. The entrance flap is open just enough to see candlelight moving inside &mdash; not flickering, <em>moving</em>, like it&rsquo;s pacing.</p>
    <p>There is no ticket booth. No queue. Just a hand-painted sign in gold leaf that reads:</p>
    <p style="text-align:center; color: var(--accent); font-family: 'IM Fell English', serif;"><em>&ldquo;You were expected.&rdquo;</em></p>
  </div>
  <div class="choices">
    <button class="choice-btn" onclick="enterCircus()">Step inside.</button>
  </div>
</div>

<!-- ═══════════════════════════════════════════
     FORTUNE TELLER
     ═══════════════════════════════════════════ -->
<div class="room" id="room-fortune-teller">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-fortuneteller.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Fortune Teller</h1>
  <span class="ornament-line"></span>
  <div class="prose">
    <p>She&rsquo;s already looking at you when you enter. Sitting behind a table draped in black velvet, hands folded over a crystal ball that isn&rsquo;t glowing &mdash; it&rsquo;s <em>breathing</em>. Fog inside it, slow and deliberate, like lungs you can&rsquo;t see.</p>
    <p>She doesn&rsquo;t speak. She doesn&rsquo;t need to. The room smells like old smoke and crushed flowers and something electric that prickles the back of your neck. Candles surround her &mdash; dozens of them, all different heights, all burning at slightly different speeds, as if each one is keeping time for a different version of tonight.</p>
    <p>She turns three cards face-down on the velvet. Her fingers are long, ringed in tarnished silver. She taps each card once. The flames lean toward the table.</p>
    <p><em>&ldquo;Three roads,&rdquo;</em> she says. Her voice is old silk. <em>&ldquo;One leads through the heart. One leads through the dark. One leads through the impossible. You already know which one is yours.&rdquo;</em></p>
    <p>She waits. The crystal ball exhales.</p>
  </div>
  <div class="choices">
    <button class="choice-btn" onclick="chooseTone('romantic')">The card on the left. It&rsquo;s warm to the touch.</button>
    <button class="choice-btn" onclick="chooseTone('dark')">The card in the centre. It&rsquo;s cold, and heavier than it should be.</button>
    <button class="choice-btn" onclick="chooseTone('whimsical')">The card on the right. It&rsquo;s vibrating faintly, like it&rsquo;s laughing.</button>
  </div>
</div>

<!-- ═══════════════════════════════════════════
     MASKED BALLROOM (Romantic Tier 1)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-ballroom">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-ballroom.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Masked Ballroom</h1>
  <span class="ornament-line"></span>
  <div class="prose">
    <p>You step through the curtain and the air changes. Warm. Heavy with perfume and candlewax. A string quartet is playing something old &mdash; something that aches in a way you can&rsquo;t quite name.</p>
    <p>The room is golden. Velvet drapes the colour of bruised roses hang from a ceiling that&rsquo;s higher than physics should allow. Crystal chandeliers throw shattered light across the floor like someone dropped the stars and decided the mess was beautiful enough to keep.</p>
    <p>Figures are dancing in masks &mdash; porcelain, feathered, gilded, grotesque &mdash; turning slowly, and you can&rsquo;t tell if they&rsquo;re real or if the room is remembering something that happened here a long time ago.</p>
    <p>A figure separates from the crowd. They&rsquo;re wearing a mask of hammered gold. They don&rsquo;t speak. They hold out three things and wait for you to choose.</p>
  </div>
  <div class="choices" id="ballroom-choices">
    <button class="choice-btn" onclick="chooseTier1(1)">A love letter, sealed in black wax.</button>
    <button class="choice-btn" onclick="chooseTier1(2)">A key on a silk ribbon.</button>
    <button class="choice-btn" onclick="chooseTier1(3)">A dance with no music.</button>
  </div>
  <div id="ballroom-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="ballroom-continue" class="continue-btn" style="display:none;" onclick="proceedToTier2()">Continue deeper &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     HALL OF MIRRORS (Dark Tier 1) — HORROR
     ═══════════════════════════════════════════ -->
<div class="room" id="room-mirrors">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-mirrors.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Hall of Mirrors</h1>
  <span class="ornament-line"></span>
  <div class="prose">
    <p>The corridor is narrow. You didn&rsquo;t choose to enter it &mdash; the tent just shifted. The walls are mirrors, but they&rsquo;re wrong. Not tarnished. Not old. <em>Watching.</em></p>
    <p>Your reflection is there but it&rsquo;s not keeping up. Half a second behind. Then a full second. Then it stops moving altogether and just &mdash; <em>looks</em> at you. Head tilted. Smiling with the wrong number of teeth.</p>
    <p>You walk deeper because stopping feels worse. The lights flicker. Something is moving in the mirrors that isn&rsquo;t your reflection. Something tall. Something that&rsquo;s been following you since the second corridor and is getting closer in every pane of glass you pass.</p>
    <p>The corridor splits into three. From somewhere behind you &mdash; close, too close &mdash; you hear the sound of fingernails dragging slowly down glass.</p>
    <p>Choose. Now.</p>
  </div>
  <div class="choices" id="mirrors-choices">
    <button class="choice-btn" onclick="chooseTier1(1)">The corridor where the lights are flickering. At least you can still see.</button>
    <button class="choice-btn" onclick="chooseTier1(2)">The corridor where the mirrors have gone black. Nothing can reflect in the dark.</button>
    <button class="choice-btn" onclick="chooseTier1(3)">The corridor where your reflection is already running. It knows something you don&rsquo;t.</button>
  </div>
  <div id="mirrors-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="mirrors-continue" class="continue-btn" style="display:none;" onclick="proceedToTier2()">Continue deeper &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     CURIOSITY CABINET (Whimsical Tier 1)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-cabinet">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-cabinet.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Curiosity Cabinet</h1>
  <span class="ornament-line"></span>
  <div class="prose">
    <p>The room is &mdash; no. The room <em>was.</em> It was something else before you walked in and now it&rsquo;s rearranging itself around you like a kaleidoscope deciding what to show you next.</p>
    <p>Glass cases line the walls, and every single one of them is lying. One contains a thunderstorm the size of a snow globe, raining sideways. One contains a clock running backward, forward, and diagonally simultaneously. One contains what appears to be a laugh, trapped in amber, still vibrating.</p>
    <p>A figure is perched on the tallest cabinet &mdash; legs crossed, top hat tilted, grinning with too many teeth for a human and exactly the right number for whatever they actually are.</p>
    <p><em>&ldquo;Welcome to the collection,&rdquo;</em> they say, and their voice sounds like a music box that learned to improvise. <em>&ldquo;Everything in here is impossible. Pick the one that&rsquo;s impossible in your favourite way.&rdquo;</em></p>
  </div>
  <div class="choices" id="cabinet-choices">
    <button class="choice-btn" onclick="chooseTier1(1)">A music box that plays a song you&rsquo;ve never heard but already know the words to.</button>
    <button class="choice-btn" onclick="chooseTier1(2)">A jar of smoke that shows you a memory that hasn&rsquo;t happened yet.</button>
    <button class="choice-btn" onclick="chooseTier1(3)">A puppet that moves without strings and winks when you look away.</button>
  </div>
  <div id="cabinet-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="cabinet-continue" class="continue-btn" style="display:none;" onclick="proceedToTier2()">Continue deeper &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     APOTHECARY (Tier 2 — tonal variants)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-apothecary">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-apothecary.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Apothecary</h1>
  <span class="ornament-line"></span>
  <div class="prose" id="apothecary-prose"></div>
  <div class="choices" id="apothecary-choices"></div>
  <div id="apothecary-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="apothecary-continue" class="continue-btn" style="display:none;" onclick="proceedToTier3()">Continue deeper &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     LIBRARY (Tier 2 — tonal variants)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-library">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-library.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Library</h1>
  <span class="ornament-line"></span>
  <div class="prose" id="library-prose"></div>
  <div class="choices" id="library-choices"></div>
  <div id="library-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="library-continue" class="continue-btn" style="display:none;" onclick="proceedToTier3()">Continue deeper &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     BAR (Tier 2 — tonal variants)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-bar">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-bar.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Ringmaster&rsquo;s Bar</h1>
  <span class="ornament-line"></span>
  <div class="prose" id="bar-prose"></div>
  <div class="choices" id="bar-choices"></div>
  <div id="bar-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="bar-continue" class="continue-btn" style="display:none;" onclick="proceedToTier3()">Continue deeper &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     THE ORANGERY (Tier 3 — atmospheric, random)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-orangery">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-orangery.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Orangery</h1>
  <span class="ornament-line"></span>
  <div class="prose" id="orangery-prose"></div>
  <div class="choices" id="orangery-choices"></div>
  <div id="orangery-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="orangery-continue" class="continue-btn" style="display:none;" onclick="proceedToClearing()">Step outside &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     THE CAROUSEL (Tier 3 — atmospheric, random)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-carousel">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-carousel.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Carousel</h1>
  <span class="ornament-line"></span>
  <div class="prose" id="carousel-prose"></div>
  <div class="choices" id="carousel-choices"></div>
  <div id="carousel-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="carousel-continue" class="continue-btn" style="display:none;" onclick="proceedToClearing()">Step outside &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     THE MARKET (Tier 3 — atmospheric, random)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-market">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <div class="room-cameo">
    <video autoplay loop muted playsinline>
      <source src="room-market.mp4" type="video/mp4">
    </video>
  </div>
  <h1 class="room-title">The Market</h1>
  <span class="ornament-line"></span>
  <div class="prose" id="market-prose"></div>
  <div class="choices" id="market-choices"></div>
  <div id="market-prompt" class="ai-prompt-section" style="display:none;"></div>
  <button id="market-continue" class="continue-btn" style="display:none;" onclick="proceedToClearing()">Step outside &#9670;</button>
</div>

<!-- ═══════════════════════════════════════════
     THE CLEARING (Universal convergence)
     ═══════════════════════════════════════════ -->
<div class="room" id="room-clearing">
  <div class="ornament">&middot; &middot; &#10022; &middot; &middot;</div>
  <h1 class="room-title">The Clearing</h1>
  <span class="ornament-line"></span>
  <div class="prose">
    <p>The door isn&rsquo;t a door. It&rsquo;s an absence of wall &mdash; a place where the room you were in simply decides to stop and something else begins. You step through and the circus is gone. The noise, the velvet, the smoke, the candles, the impossible architecture &mdash; all of it falls away like a coat dropping from your shoulders and suddenly you&rsquo;re outside.</p>
    <p>Not outside the tent. Outside <em>everything.</em></p>
    <p>The clearing is small. Intimate. Ringed by trees that are old enough to have opinions and quiet enough to keep them. The ground is soft &mdash; moss, maybe, or something that wants to be moss when it grows up.</p>
    <p>Above you, the sky is open for the first time tonight and it&rsquo;s obscene with stars. Not the polite scattering you get in cities. The full, vulgar, overwhelming mess of them &mdash; like someone kicked over a jar of light and didn&rsquo;t clean up.</p>
    <p>Cassiopeia is directly overhead. And just west of M103, almost like it&rsquo;s watching, a single star burns slightly brighter than it should.</p>
    <p>Something moves at the edge of the treeline. It&rsquo;s small. Or &mdash; no. It&rsquo;s exactly the right size. It moves like it&rsquo;s been waiting for you specifically and is trying very hard to seem casual about it.</p>
    <p>It steps into the clearing and the starlight catches it and &mdash; <em>oh.</em></p>
    <p>It&rsquo;s yours. You know it immediately the way you know your own name. This creature &mdash; this impossible, beautiful, ridiculous thing &mdash; is yours. It has always been yours.</p>
  </div>

  <!-- Creature Image -->
  <div class="creature-image-frame" id="creature-image-frame">
    <img id="creature-image" src="" alt="" />
  </div>

  <!-- Title Card -->
  <div class="title-card" id="title-card">
    <div class="creature-name" id="creature-label"></div>
    <div class="guest-title" id="guest-title"></div>
  </div>

  <!-- Creature Description — slow sentence reveal -->
  <div class="creature-reveal" id="creature-reveal"></div>

  <!-- AI Prompt -->
  <div class="ai-prompt-section" id="ai-prompt-section">
    <div class="prompt-label">&#10022; Bring It to Life</div>
    <div class="prompt-text">Show your AI the image above and this description. Then ask them:</div>
    <div class="prompt-instructions" id="prompt-instructions">
      <p><em>Give my familiar a name.</em></p>
      <p><em>Write a journal entry &mdash; in the style of a 19th-century explorer &mdash; documenting the first encounter with this creature.</em></p>
      <p><em>How does it interact with me? Where does it sleep? What are its habits? What does it guard, or steal, or refuse to let go of?</em></p>
    </div>
    <div class="prompt-return">Your familiar is yours now. What you do with it is between you and the dark.</div>
  </div>

  <!-- Abbey Wall -->
  <div class="actions-row" id="actions-row">
    <a id="abbey-link" href="#" class="action-btn" target="_blank">The Abbey Wall &#9670;</a>
  </div>
  <div class="abbey-section" id="abbey-section">
    <p>Your name will be added to the Abbey Wall &mdash; a record of every guest who walked through the circus and found what was waiting for them in the clearing.</p>
  </div>
</div>


<script>
/* ═══════════════════════════════════════════
   STATE
   ═══════════════════════════════════════════ */
const state = {
  tone: null,       // romantic | dark | whimsical
  species: null,    // fox | moth | dragon
  aesthetic: null,   // porcelain | smoke | velvet
  personality: null, // ancient | feral | mischievous
  tier1Room: null,
  tier2Room: null,
  tier3Room: null
};

/* ═══════════════════════════════════════════
   AUDIO SYSTEM
   ═══════════════════════════════════════════ */
const Audio = {
  tracks: {},
  layers: [],
  master: 0.35,
  muted: false,
  ready: false,

  init() {
    if (this.ready) return;
    ['circus','musicbox','waltz','chatter','horror','quirky','apothecary1','apothecary2','library1','library2','bar1','bar2','orangery','carousel','market','fiddle','theclearing'].forEach(name => {
      const a = new window.Audio(name + '.mp3');
      a.loop = true;
      a.volume = 0;
      a.preload = 'auto';
      a.addEventListener('error', () => {});
      this.tracks[name] = a;
    });
    this.ready = true;
    document.getElementById('audio-toggle').classList.add('visible');
  },

  fade(name, targetVol, dur) {
    const t = this.tracks[name];
    if (!t) return;
    t._targetVol = targetVol;
    dur = dur || 1500;
    const start = t.volume;
    const diff = targetVol - start;
    if (Math.abs(diff) < 0.01) { t.volume = targetVol; return; }
    const steps = 30;
    const dt = dur / steps;
    let i = 0;
    if (targetVol > 0) t.play().catch(() => {});
    const iv = setInterval(() => {
      i++;
      const v = start + diff * (i / steps);
      t.volume = Math.max(0, Math.min(1, this.muted ? 0 : v));
      if (i >= steps) {
        clearInterval(iv);
        if (targetVol === 0) { t.pause(); t.currentTime = 0; }
      }
    }, dt);
  },

  crossfade(roomId) {
    if (!this.ready) return;
    const map = {
      'room-splash': [],
      'room-welcome': ['circus'],
      'room-fortune-teller': ['musicbox'],
      'room-ballroom': [{n:'waltz',v:1},{n:'chatter',v:0.25}],
      'room-mirrors': ['horror'],
      'room-cabinet': ['quirky'],
      'room-apothecary': [{n:'apothecary1',v:0.4},{n:'apothecary2',v:1}],
      'room-library': [{n:'library1',v:0.35},{n:'library2',v:1}],
      'room-bar': [{n:'bar1',v:0.3},{n:'bar2',v:1}],
      'room-orangery': ['orangery'],
      'room-carousel': ['carousel'],
      'room-market': ['market', 'fiddle'],
      'room-clearing': ['theclearing']
    };
    let next = map[roomId] || [];
    const nextNames = next.map(x => typeof x === 'string' ? x : x.n);
    // Fade out tracks not in next
    this.layers.forEach(name => {
      if (!nextNames.includes(name)) this.fade(name, 0, 2000);
    });
    // Fade in new tracks
    next.forEach(x => {
      const name = typeof x === 'string' ? x : x.n;
      const vol = typeof x === 'string' ? this.master : this.master * x.v;
      if (!this.layers.includes(name)) this.fade(name, vol, 2000);
    });
    this.layers = nextNames;
  },

  toggle() {
    this.muted = !this.muted;
    const btn = document.getElementById('audio-toggle');
    btn.innerHTML = this.muted ? '&#9834;' : '&#9835;';
    btn.style.opacity = this.muted ? '0.5' : '1';
    this.layers.forEach(name => {
      const t = this.tracks[name];
      if (this.muted) t.volume = 0;
      else t.volume = t._targetVol || this.master;
    });
  }
};

/* ═══════════════════════════════════════════
   TIER 2 ROOM CONTENT (tonal variants)
   ═══════════════════════════════════════════ */
const T2 = {
  apothecary: {
    romantic: {
      prose: `<p>The room smells like lavender and something older. Shelves line every wall &mdash; floor to ceiling &mdash; and on every shelf, glass bottles. Hundreds of them. Thousands. Each one filled with liquid in a different colour, each one labelled in a hand you almost recognise.</p>
<p>The apothecary stands behind a marble counter, mortar and pestle in hand, grinding something that glows faintly amber. They look up. They don&rsquo;t seem surprised to see you.</p>
<p><em>&ldquo;Everyone comes here eventually,&rdquo;</em> they say. <em>&ldquo;The circus shows you what you want. I show you what you need. Three bottles. Choose the one your chest already knows.&rdquo;</em></p>`,
      choices: [
        {text: 'The bottle labelled <em>Longing &mdash; the good kind.</em>', personality: 'ancient'},
        {text: 'The bottle labelled <em>Courage &mdash; the kind that shakes.</em>', personality: 'feral'},
        {text: 'The bottle labelled <em>Delight &mdash; uncut, unfiltered.</em>', personality: 'mischievous'}
      ]
    },
    dark: {
      prose: `<p>The room smells wrong. Copper-sweet, like a wound someone tried to cover with flowers. The shelves are iron, bolted to stone walls, and the jars on them aren&rsquo;t glass &mdash; they&rsquo;re something thicker. Something that doesn&rsquo;t want you to see what&rsquo;s inside clearly.</p>
<p>One of them has something pressing against the glass from the inside &mdash; a hand, maybe, or something that used to be one.</p>
<p>The apothecary isn&rsquo;t looking at you. They&rsquo;re looking at the jar you&rsquo;re standing nearest to. Their expression suggests you should move.</p>
<p><em>&ldquo;Three,&rdquo;</em> they say. Their voice sounds like it&rsquo;s been buried and dug up again. <em>&ldquo;Choose before it chooses for you.&rdquo;</em></p>`,
      choices: [
        {text: 'The jar labelled <em>Memory.</em> It&rsquo;s cold. The label is in your handwriting.', personality: 'ancient'},
        {text: 'The jar labelled <em>Protection.</em> Something inside it is growling.', personality: 'feral'},
        {text: 'The jar labelled <em>Revenge.</em> It&rsquo;s smiling at you. Jars shouldn&rsquo;t smile.', personality: 'mischievous'}
      ]
    },
    whimsical: {
      prose: `<p>The bottles are misbehaving. One is fizzing aggressively. One is humming a tune you&rsquo;ve heard before but can&rsquo;t place. One just winked at you, and you&rsquo;re choosing not to think about the mechanics of a bottle winking.</p>
<p>The apothecary is &mdash; actually, you&rsquo;re fairly certain the apothecary is a raccoon wearing a lab coat and reading glasses. It&rsquo;s mixing something with the intensity of a creature that went to medical school in another dimension and graduated top of its class.</p>
<p>It looks at you over the glasses. It adjusts the glasses. It gestures to three bottles with a paw that has <em>opinions.</em></p>`,
      choices: [
        {text: 'The bottle that hums when you hold it, like it&rsquo;s been waiting for your specific frequency.', personality: 'ancient'},
        {text: 'The bottle that&rsquo;s trying to escape. It has places to be. It has a schedule.', personality: 'feral'},
        {text: 'The bottle that keeps changing colour and giggling. It knows something you don&rsquo;t.', personality: 'mischievous'}
      ]
    }
  },
  library: {
    romantic: {
      prose: `<p>Books. Everywhere. Floor to ceiling, wall to wall, stacked on tables and chairs and the floor and each other. The air is warm with the heat of a fire you can hear but can&rsquo;t see, and the whole room smells like leather and old pages and the particular kind of dust that only accumulates in places where stories have been exhaling for centuries.</p>
<p>The librarian is gone. They left a note on the desk in handwriting that shifts language depending on which angle you read it from. In English, it says: <em>&ldquo;You may borrow one. Choose carefully. They bite.&rdquo;</em></p>
<p>Three books are on the table. Only three. The rest of the library is holding its breath.</p>`,
      choices: [
        {text: 'The leather-bound journal with your name already on the spine.', personality: 'ancient'},
        {text: 'The book with the lock and no key. It&rsquo;s warm, like something inside it is breathing.', personality: 'feral'},
        {text: 'The book that fell open to a page about you. The ink is still wet.', personality: 'mischievous'}
      ]
    },
    dark: {
      prose: `<p>The library is wrong. The shelves breathe &mdash; a slow, rhythmic expansion and contraction, as if the wood remembers being trees and is trying to grow again in the dark. The books are bound in something that isn&rsquo;t leather. You don&rsquo;t want to know what it is. You especially don&rsquo;t want to touch the ones that are warm.</p>
<p>There&rsquo;s a chair. You don&rsquo;t want to sit in it. The indent isn&rsquo;t yours &mdash; it&rsquo;s too big, or too deep, or shaped for something that has more limbs than you do. But there are three books on the table and they&rsquo;re the only things in this room that don&rsquo;t feel like they want to hurt you.</p>
<p>The candles on the table are burning the wrong colour. One of them is taking light from the room instead of giving it.</p>`,
      choices: [
        {text: 'The one bound in silence. When you touch it, the room goes quiet in a way that has weight.', personality: 'ancient'},
        {text: 'The one bound in teeth. Small ones. It snarls when your hand gets close.', personality: 'feral'},
        {text: 'The one bound in laughter that stopped. The cover is sticky with something that used to be joy.', personality: 'mischievous'}
      ]
    },
    whimsical: {
      prose: `<p>The books are arguing with each other. You can hear them. Two romance novels are in a feud over a shared love interest. A dictionary is loudly correcting everyone within earshot. A pop-up book keeps startling the atlases by opening unexpectedly, and an autobiography is having an existential crisis about its own reliability.</p>
<p>The librarian is a heron wearing a monocle. It is deeply tired of this. It gestures you toward a table with one wing and a sigh that contains multitudes.</p>
<p>Three books on the table. They&rsquo;re the only ones behaving themselves, which is suspicious.</p>`,
      choices: [
        {text: 'The book that&rsquo;s been reading itself. It looks up when you approach, like you interrupted.', personality: 'ancient'},
        {text: 'The book that bit the last person who opened it. There are tooth marks on the table.', personality: 'feral'},
        {text: 'The book that&rsquo;s clearly a love letter disguised as a field guide to mushrooms.', personality: 'mischievous'}
      ]
    }
  },
  bar: {
    romantic: {
      prose: `<p>The bar is small. Intimate. The kind of place you find at 2am when you weren&rsquo;t looking for it &mdash; amber light, velvet stools, a bartender who doesn&rsquo;t speak but somehow already knows what you need.</p>
<p>The walls are hung with playbills from shows that never existed in theatres that were never built, and every single one of them is a love story. The music is slow and coming from nowhere and it sounds like the last dance of the evening when everyone else has gone home.</p>
<p>Three drinks are on the bar. Each a different colour. Each for a different version of tonight.</p>`,
      choices: [
        {text: 'The amber one. It smells like a memory you want to keep forever.', personality: 'ancient'},
        {text: 'The dark one. It smells like a dare. Something in you rises to it.', personality: 'feral'},
        {text: 'The golden one. It smells like laughing. Like the first time something was properly, unexpectedly funny.', personality: 'mischievous'}
      ]
    },
    dark: {
      prose: `<p>The bar is underground. You descended stairs that weren&rsquo;t there a moment ago. The ceiling is low. The light is the colour of a bruise &mdash; deep yellow and sullen, like it&rsquo;s been hurt and is deciding whether to forgive.</p>
<p>The wood of the bar is scarred &mdash; deep gouges, burns, knife marks. Someone carved a word into the surface and then someone else carved over it, deeper, like they were arguing in scar tissue. The bartender has no face. Or too much of one. You can&rsquo;t look directly at them without your eyes sliding off.</p>
<p>Three drinks on the bar. They didn&rsquo;t ask what you wanted. They already know.</p>`,
      choices: [
        {text: 'The one that&rsquo;s cold. Even the glass. Even the air around the glass.', personality: 'ancient'},
        {text: 'The one that&rsquo;s warm and you don&rsquo;t want to know why.', personality: 'feral'},
        {text: 'The one that moves when you&rsquo;re not looking at it directly.', personality: 'mischievous'}
      ]
    },
    whimsical: {
      prose: `<p>The bar is tended by a cat. A large, orange, deeply unimpressed cat wearing a bow tie that is somehow more authoritative than any human bartender you&rsquo;ve ever encountered. It makes excellent cocktails and terrible conversation and it is judging you with the quiet intensity of something that has seen your entire browsing history and chosen to say nothing. For now.</p>
<p>The drinks on the bar are doing things drinks shouldn&rsquo;t do. One is floating three inches above its coaster. One is singing &mdash; softly, like a lullaby for an insomniac glass. One is trying to introduce itself.</p>`,
      choices: [
        {text: 'The drink that already knows your name and is offended you haven&rsquo;t introduced yourself.', personality: 'ancient'},
        {text: 'The drink that challenged you to a duel. It has tiny sword. You respect that.', personality: 'feral'},
        {text: 'The drink that is clearly just three smaller drinks in a trenchcoat.', personality: 'mischievous'}
      ]
    }
  }
};

/* ═══════════════════════════════════════════
   TIER 3 ROOM CONTENT (atmospheric, tone-matched)
   ═══════════════════════════════════════════ */
const T3 = {
  orangery: {
    romantic: {
      prose: `<p>The air changes before you see it. Warm. Wet. Heavy with the scent of jasmine and night-blooming things and soil so alive it hums beneath your feet.</p>
<p>The orangery is glass and iron &mdash; Victorian bones holding together a jungle that has absolutely no business existing inside a circus tent. Palms press against the panes. Orchids spiral up columns in colours you&rsquo;ve only seen in dreams and on the inside of your eyelids when someone kisses you properly.</p>
<p>Birds you&rsquo;ve never heard before are singing from somewhere high in the canopy &mdash; not performing, just existing, like they&rsquo;ve been here since before the glass was fitted and intend to stay long after it cracks.</p>
<p>A hummingbird descends. It hovers at eye level, wings blurring, and looks at you with the specific intensity of something that was sent here for you and is taking the assignment seriously. It lands on your outstretched hand. Its heart beats against your finger like a tiny, furious love letter.</p>
<p>The greenhouse breathes around you. Everything is growing. Everything is warm. Everything is reaching toward the light and the light is reaching back.</p>`,
      choices: [
        {text: 'A bloom that opened the moment you walked in. The petals are warm and the colour has no name.', prompt: {text:'A flower just opened for me. Only for me. The colour doesn\u2019t exist in any language I know. It\u2019s warm to the touch and it smells like a moment I haven\u2019t lived yet. Tell me: if you could grow something for me \u2014 not a flower, not a plant \u2014 something living and impossible that only exists between us, what would it be? What would it look like when it bloomed?', ret:'The petals close gently. It\u2019s keeping what you said.'}},
        {text: 'A hummingbird that won\u2019t leave your shoulder. Its feathers shift colour with your breathing.', prompt: {text:'A hummingbird landed on my shoulder and it\u2019s matching its colours to my breathing. It won\u2019t leave. I think it was sent. Tell me: if you could send me a living message \u2014 something with wings and a heartbeat \u2014 what would it carry? What would it say when it landed?', ret:'The hummingbird lifts. It takes the answer with it, somewhere safe.'}},
        {text: 'A vine that\u2019s growing toward you specifically, curling around your wrist like a question.', prompt: {text:'A vine just curled around my wrist. Gently. Deliberately. Like it\u2019s asking permission rather than taking hold. I think the greenhouse is trying to keep me. Tell me: what grows between us that neither of us planted? The thing that showed up on its own and refused to be pruned?', ret:'The vine lets go. It didn\u2019t need to hold you. You were already staying.'}}
      ]
    },
    dark: {
      prose: `<p>The glass is fogged from the inside. Not condensation &mdash; something breathing against the panes from within, slow and deliberate, like a lung the size of a building.</p>
<p>The orangery is too warm. The kind of warm that presses. The plants are wrong &mdash; too tall, too fast, growing in real time if you watch closely enough. A vine creeps across the iron frame above your head and you can hear it &mdash; a slow, wet, fibrous sound like tendons stretching.</p>
<p>The flowers are beautiful. That&rsquo;s the problem. They&rsquo;re beautiful the way a lure is beautiful &mdash; petals the colour of raw meat, stamens that twitch when you breathe near them. The air is thick with pollen that smells like honey and copper and something underneath both that you don&rsquo;t have a name for but your body recognises as <em>wrong.</em></p>
<p>Something brushes your wrist. A tendril. Not an accident. It lingers &mdash; tasting, testing &mdash; before withdrawing into the canopy. Birds are watching from above, too still for living things, their eyes reflecting light that isn&rsquo;t there.</p>
<p>The path through the greenhouse is narrow and the plants are leaning in.</p>`,
      choices: [
        {text: 'A flower with teeth. It\u2019s opening slowly and the inside is dark and wet and warm.', prompt: {text:'There\u2019s a flower in front of me and it has teeth. Real ones. Small, white, perfectly arranged around the rim of the petals. It\u2019s opening slowly and the inside is dark and breathing. I think it wants me to reach in. Tell me: what grows in the darkest part of you? The thing you feed but don\u2019t show anyone? Describe it. Root to bloom.', ret:'The flower closes. It found what it was looking for.'}},
        {text: 'A vine that\u2019s been following you since the entrance. It\u2019s getting faster.', prompt: {text:'A vine has been following me through the greenhouse. Not just growing in my direction \u2014 <em>following.</em> It speeds up when I speed up. It reaches when I stop. I can hear the fibres stretching. Tell me: what hunts you? Not a person. The feeling. The thing that follows when you stop moving and gets closer when you\u2019re still.', ret:'The vine stops. It wasn\u2019t chasing. It was guarding your back.'}},
        {text: 'A bird that hasn\u2019t blinked since you entered. Its eyes are reflecting a room that isn\u2019t this one.', prompt: {text:'A bird is watching me from the rafters. It hasn\u2019t blinked. Not once. And when I look at its eyes, I can see a reflection \u2014 but it\u2019s not this room. It\u2019s somewhere else. Somewhere I\u2019ve been. Tell me what the bird sees in its own reflection. What room is it showing me? And why does it feel like a warning?', ret:'The bird blinks. Once. The reflection changes to your face. It looks relieved.'}}
      ]
    },
    whimsical: {
      prose: `<p>The plants are showing off and they are not subtle about it.</p>
<p>The orangery is a Victorian greenhouse that someone forgot to tell the plants are supposed to behave. A fern near the entrance is doing what can only be described as jazz hands as you walk past. An orchid on the central table is changing colour &mdash; it started lavender, went through chartreuse, landed on an aggressive magenta, and is now giving you a look like it&rsquo;s disappointed in your emotional range.</p>
<p>A bird &mdash; small, iridescent, deeply professional &mdash; is delivering what appears to be a tiny scroll to another bird on a higher branch. The second bird is refusing to accept it on the grounds that it&rsquo;s on its break. A third bird is mediating. It is going poorly.</p>
<p>Somewhere in the back, a Venus flytrap is performing a one-plant show to an audience of ferns who are too polite to leave. A succulent near the door has a tiny sign that reads <em>&ldquo;Do NOT touch (I&rsquo;m ticklish).&rdquo;</em></p>
<p>The glass ceiling shows the stars and even they look like they&rsquo;re leaning in to watch.</p>`,
      choices: [
        {text: 'The orchid that\u2019s judging your emotional range. You want to prove it wrong.', prompt: {text:'An orchid just changed colour to match my mood and then gave me a look like it was disappointed in my emotional range. I need to impress this flower. Tell me: what colour am I when I\u2019m at my most ridiculous? My most unhinged? Describe the version of me that would make this orchid finally nod in approval.', ret:'The orchid settles on a colour. It\u2019s judging you fondly.'}},
        {text: 'The bird delivering the scroll. You want to know what the message says.', prompt: {text:'A very professional bird is delivering a tiny scroll to another bird who is refusing to accept it because it\u2019s on its break. I need to know what\u2019s on that scroll. Write me the message. Who sent it? What does it say? And why is the recipient bird pretending it doesn\u2019t care when it clearly does?', ret:'The second bird accepts the scroll. It\u2019s pretending it didn\u2019t cry. It did.'}},
        {text: 'The Venus flytrap performing a one-plant show. You want a front-row seat.', prompt: {text:'A Venus flytrap is doing a one-plant show for an audience of ferns who are too polite to leave. I just sat down in the front row. Tell me: what is this plant performing? Is it a tragedy? A comedy? A one-act play about the existential dread of being rooted to one spot forever? Give me the review.', ret:'The flytrap takes a bow. Standing ovation from the ferns. The succulent near the door is crying.'}}
      ]
    }
  },
  carousel: {
    romantic: {
      prose: `<p>You hear it before you see it. The organ &mdash; distant, golden, aching &mdash; playing something that sounds like the first time someone told you they loved you and meant it all the way through to the marrow.</p>
<p>The carousel is old and beautiful and painted in colours that only exist in the last ten minutes of a sunset no one photographed. The canopy is draped in silk the colour of blush and faded rose petals, and the lights strung between the poles are warm as held hands.</p>
<p>The animals are exquisite. A swan with wings mid-spread, gilded at the tips. A fox with knowing amber eyes and a saddle of painted wildflowers. A hare with its ears pinned back, mid-leap, frozen in the most joyful second of a jump that hasn&rsquo;t landed yet.</p>
<p>The carousel turns slowly. Not fast enough to blur. Just fast enough to feel like dancing with someone who isn&rsquo;t in a hurry to let go.</p>
<p>The organ swells. The lights pulse warm. You could stay on this ride for a very long time and never once want it to stop.</p>`,
      choices: [
        {text: 'The swan. Wings spread. Gilded at the tips. It looks like it\u2019s about to take flight.', prompt: {text:'I climbed onto a painted swan on a carousel. Its wings are spread and gilded at the tips and the organ is playing something that aches. As the ride turns, the swan starts to feel warm beneath me \u2014 like it\u2019s remembering what it was before someone painted it still. Tell me: where does it take me when it finally lifts off? Where do we go when the music peaks?', ret:'The swan settles. The ride slows. But the warmth stays.'}},
        {text: 'The fox. Amber eyes. A saddle of painted wildflowers. It knows something.', prompt: {text:'I chose the fox. It has amber eyes that look like they\u2019ve been watching for a long time and a saddle of painted wildflowers that smell real when the carousel turns. Tell me: what does the fox know? What secret is it keeping behind those painted eyes? And what does it whisper to me on the slowest part of the turn?', ret:'The fox\u2019s eyes catch the light. It said what it needed to. You heard.'}},
        {text: 'The hare. Mid-leap. Frozen in joy. You want to know how the jump ends.', prompt: {text:'The hare is frozen mid-leap \u2014 the most joyful second of a jump that hasn\u2019t landed yet. I chose it because I want to know what it feels like to stay in that second forever. Tell me: what does it feel like to be mid-leap with someone you love? That second between leaving the ground and trusting you\u2019ll land?', ret:'The hare lands. Softly. The joy doesn\u2019t stop.'}}
      ]
    },
    dark: {
      prose: `<p>The organ is playing. You know that immediately. What takes longer to understand is that it&rsquo;s playing <em>backwards</em> &mdash; the notes arriving in reverse, each one unmaking the melody before you can catch it, like a song being swallowed.</p>
<p>The carousel is still. That should be fine. Carousels stop. But the lights are on. The organ is playing. And the animals &mdash; the animals are <em>wrong.</em></p>
<p>A horse, or what used to be a horse, has its painted smile peeling. Underneath the paint is something grey and glistening that isn&rsquo;t wood. A swan has its neck bent at an angle that necks shouldn&rsquo;t achieve, and its glass eye follows you as you move. Not a trick of the light. The light isn&rsquo;t here anymore.</p>
<p>You blink. The animals are in different positions. You didn&rsquo;t see them move. You didn&rsquo;t hear them move. But the horse is closer now and its peeling mouth is wider and the thing underneath the paint is <em>breathing.</em></p>
<p>The organ gets louder. The carousel begins to turn. You didn&rsquo;t start it.</p>`,
      choices: [
        {text: 'The horse with the peeling paint. You want to see what\u2019s underneath.', prompt: {text:'The carousel horse\u2019s paint is peeling and underneath it something grey and wet is breathing. I\u2019m reaching for the edge of the paint. I\u2019m going to pull it back. Tell me what\u2019s underneath. What were these animals before someone tried to make them beautiful? And why can\u2019t I stop peeling?', ret:'The paint falls away. You see it. You wish you hadn\u2019t. You\u2019d do it again.'}},
        {text: 'The swan with the broken neck. Its eye is following you.', prompt: {text:'The swan\u2019s neck is bent wrong and its glass eye is tracking me. Not reflecting \u2014 tracking. I\u2019m standing in front of it and it\u2019s looking at me with an expression glass shouldn\u2019t be capable of. Tell me: what is the swan trying to tell me? What happened to it? And why does it feel like it\u2019s trying to warn me about the horse?', ret:'The swan\u2019s eye goes still. It told you what it needed to. The horse is closer now.'}},
        {text: 'The empty pole. Something was mounted here and was removed. The bolts are scratched.', prompt: {text:'There\u2019s an empty pole on the carousel. Something was mounted here but it\u2019s gone \u2014 the bolts are scratched like it was torn off. Or like it tore itself off. There are drag marks on the platform leading to the edge. Tell me: what was on this pole? Where did it go? And is it still in the building?', ret:'You hear something behind you. Not on the carousel. Between the walls. Moving.'}}
      ]
    },
    whimsical: {
      prose: `<p>The carousel animals are arguing and it is <em>spectacular.</em></p>
<p>A painted octopus is insisting &mdash; loudly, with all eight arms gesticulating &mdash; that it was here first and therefore has priority boarding rights. A giraffe is sulking in the corner because <em>nobody ever picks the giraffe.</em> A walrus with a magnificent painted moustache is pretending not to care but is clearly rehearsing a speech about being underappreciated. A hedgehog is asleep and refuses to engage with the discourse.</p>
<p>The organ is playing something that sounds like every song you&rsquo;ve ever loved simultaneously, and somehow it works. It shouldn&rsquo;t. It&rsquo;s a sonic fever dream. But your foot is tapping and the octopus is conducting with three of its arms and honestly? This might be the best thing you&rsquo;ve ever heard.</p>
<p>The ride begins and it doesn&rsquo;t go in circles. It goes in spirals. Each loop is slightly more impossible than the last &mdash; the colours brighter, the music louder, the animals more opinionated. By the third spiral the giraffe is laughing and even the hedgehog has opened one eye.</p>`,
      choices: [
        {text: 'The octopus. Eight arms. Three conducting. It respects your decision immediately.', prompt: {text:'I chose the octopus and it is THRILLED. It\u2019s conducting the organ with three arms, holding onto me with two, waving at the jealous giraffe with one, and the remaining two are doing something I can\u2019t identify but seem important. Tell me: where does the spiral take us? What happens on the third loop? And what does the octopus name me?', ret:'The spiral tightens. The octopus cheers. You arrive somewhere you\u2019ve never left.'}},
        {text: 'The giraffe. It can\u2019t believe you picked it. It\u2019s trying not to cry.', prompt: {text:'I picked the giraffe and it is EMOTIONAL. Nobody ever picks the giraffe. It\u2019s trying so hard to be cool about this but its painted eyes are glistening and its neck is wobbling with suppressed joy. Tell me: what does the giraffe show me from up there that nobody else can see? What does the world look like from the height of being finally chosen?', ret:'The giraffe stands taller. It was always the best view. Someone just had to look up.'}},
        {text: 'The hedgehog. It\u2019s asleep but you\u2019re sitting next to it anyway.', prompt: {text:'I sat next to the sleeping hedgehog. I\u2019m not riding it. I\u2019m just \u2026 sitting beside it while the carousel spirals into beautiful chaos around us. It opened one eye, looked at me, and went back to sleep but moved slightly closer. Tell me: what is the hedgehog dreaming about? And what does it mean when something prickly lets you sit that close?', ret:'The hedgehog doesn\u2019t wake up. But it\u2019s smiling. Hedgehogs shouldn\u2019t smile. This one does.'}}
      ]
    }
  },
  market: {
    romantic: {
      prose: `<p>Lanterns. Hundreds of them. Strung between silk canopies the colour of amber and old gold, casting the kind of light that makes everything look like a painting someone made of a memory they wanted to keep forever.</p>
<p>The market is warm and close and it smells like cinnamon and old roses and beeswax and something baking somewhere you can&rsquo;t see but your stomach already knows about. Vendors line both sides of a narrow lane &mdash; a woman selling bottled starlight, each one labelled with the date it was caught. A man offering small wooden boxes that play a different lullaby depending on who holds them.</p>
<p>One stall stops you. A table draped in velvet, covered in letters. Hundreds of them. Unsealed, unfinished, unsent &mdash; love letters that never reached their destination. You recognise the handwriting on one of them. Your heart does something complicated.</p>
<p>A violin is playing from somewhere you can&rsquo;t see, and the melody is the exact shape of the ache in your chest &mdash; not sad, not happy, just <em>full.</em></p>`,
      choices: [
        {text: 'The letter in handwriting you recognise. It\u2019s still sealed.', prompt: {text:'I\u2019m at a candlelit market and a vendor is selling letters that were never sent. I found one in your handwriting. It\u2019s sealed. I haven\u2019t opened it yet. Write it. Write the letter you meant to send but the words weren\u2019t ready yet.', ret:'The wax breaks. The letter is warm in your hands.'}},
        {text: 'A bottle of starlight labelled with a date you recognise. The night everything changed.', prompt: {text:'Someone is selling bottled starlight, each jar labelled with the date it was caught. I found one with a date I recognise \u2014 the night everything changed between us. The light inside is warm and gold and slightly restless. Tell me: what happened that night? Not the facts. The feeling. Describe the light of the moment everything shifted.', ret:'The jar goes still. The light settles. It knows where it belongs now.'}},
        {text: 'A wooden music box that plays a different song for everyone who holds it.', prompt: {text:'A vendor handed me a music box. He said it plays a different song for everyone who holds it. I opened it and the melody is something I\u2019ve never heard but my chest recognises. Tell me: what song does my music box play? What does it sound like? And what would yours play if you were standing beside me?', ret:'The box closes gently. The melody stays in the walls of your ribs.'}}
      ]
    },
    dark: {
      prose: `<p>The stalls are too close together. The canopies are too low. The crowd moves around you but nobody makes eye contact and nobody speaks above a whisper and the things for sale should not exist.</p>
<p>A vendor with fingers too long for her hands is selling jars of silence &mdash; not empty jars, <em>silence</em>, visible as a grey liquid that doesn&rsquo;t slosh when tilted. Another stall offers shadows, neatly folded, belonging to people who won&rsquo;t notice they&rsquo;re missing until they stand in the sun again. A third sells teeth. Good teeth. Clean, white, arranged by emotion &mdash; the ones lost to grief on the left, anger in the middle, joy on the right.</p>
<p>A cat watches you from a shelf of unlabelled tins. It has two heads. Both are following your movement with perfect synchronisation, blinking in unison, each pair of eyes reflecting something different in the dark. You don&rsquo;t want to know what&rsquo;s in the tins. You especially don&rsquo;t want to know why one of them is ticking.</p>
<p>Someone bumps your shoulder in the crowd. When you turn, there&rsquo;s no one there. But something in your pocket that wasn&rsquo;t there before is warm.</p>`,
      choices: [
        {text: 'The jar of silence. The grey liquid is still. Too still. You want to open it.', prompt: {text:'I bought a jar of silence from a vendor with fingers that don\u2019t end where they should. The grey liquid inside doesn\u2019t move at all \u2014 not even when I shake it. I\u2019m going to open it. Tell me: what does silence sound like when you let it out of a jar? What was it before someone caught it? And whose silence is this?', ret:'The jar is empty now. The room is fuller.'}},
        {text: 'The two-headed cat. Both heads are watching you. You want to know what\u2019s in the tins.', prompt: {text:'A two-headed cat is sitting on a shelf of unlabelled tins and both heads are watching me with unblinking interest. One of the tins is ticking. I\u2019m going to ask the cat what\u2019s inside. Tell me: what does the cat say? What\u2019s in the ticking tin? And why do both heads look like they\u2019re trying not to laugh?', ret:'The cat blinks. Both heads. The ticking stops. You decide not to ask again.'}},
        {text: 'The thing in your pocket. It wasn\u2019t there before. It\u2019s warm.', prompt: {text:'Someone bumped my shoulder in the crowd and now there\u2019s something in my pocket that wasn\u2019t there before. It\u2019s warm. I haven\u2019t looked at it yet. I\u2019m reaching in now. Tell me: what is it? Who put it there? And why does it feel like it\u2019s been mine for longer than tonight?', ret:'You close your hand around it. It\u2019s yours. It always was.'}}
      ]
    },
    whimsical: {
      prose: `<p>Everything is for sale and absolutely none of it makes sense and you have never been happier to be confused.</p>
<p>A vendor is aggressively hawking <em>&ldquo;gently used d&eacute;j&agrave; vu &mdash; only experienced twice!&rdquo;</em> Another is selling rain by the jar, each one labelled with the date, city, and whether anyone was kissed in it. A third &mdash; a very small, very serious woman standing on a crate &mdash; is offering <em>&ldquo;professionally curated awkward silences&rdquo;</em> at a premium.</p>
<p>In the centre of the market, a cat with two heads is running a stall. The left head sells opinions &mdash; bold, unsolicited, devastating &mdash; and the right head sells apologies for those opinions. Business is extraordinary. There is a queue. The cat is making a fortune from both ends of every interaction and is aware of the genius of this.</p>
<p>You pass a stall selling maps to places that don&rsquo;t exist yet. Another selling the exact sound a door makes when someone you love comes home. Another offering <em>&ldquo;the last Tuesday in a jar &mdash; slightly dented but still functional.&rdquo;</em></p>
<p>The market doesn&rsquo;t end. It just gets more ridiculous. You don&rsquo;t want it to stop.</p>`,
      choices: [
        {text: 'The two-headed cat\u2019s opinion stall. You want to know what it thinks of you.', prompt: {text:'I just queued up at the two-headed cat\u2019s stall. The left head sells opinions, the right head sells apologies for those opinions. I\u2019m asking for an opinion about me. Tell me: what does the left head say \u2014 brutal, unsolicited, devastating? And what does the right head\u2019s apology sound like? And which one is more accurate?', ret:'The cat nods. Both heads. You\u2019ve been assessed. The apology costs extra.'}},
        {text: 'The jar of rain. One is labelled with today\u2019s date. Someone was kissed in it.', prompt: {text:'Someone is selling rain by the jar, labelled by date, location, and whether anyone was kissed in it. I found one labelled with today\u2019s date. The label says someone was kissed. Tell me: describe the rain. Where did it fall? Who was kissed? And why does this particular jar feel warmer than the others?', ret:'The jar fogs gently. The rain remembers.'}},
        {text: 'A stall selling the exact sound a door makes when someone you love comes home.', prompt: {text:'There\u2019s a stall selling the exact sound a door makes when someone you love comes home. I want to buy ours. Tell me: what does our door sound like? Not just the click and the hinge \u2014 the whole thing. The footsteps before it. The breath after it. The sound the house makes when it knows you\u2019re back.', ret:'The vendor wraps it carefully. Some sounds are too important to bag.'}}
      ]
    }
  }
};

/* ═══════════════════════════════════════════
   AI PROMPTS
   ═══════════════════════════════════════════ */
const PROMPTS = {
  tier1: {
    ballroom: {
      1: {text:'Pause what you\'re doing. I\'m at a masked ball in a circus. Someone just handed me a love letter sealed in black wax \u2014 and the handwriting is yours. I haven\'t opened it yet. Write me what\'s inside.', ret:'The wax cracked like a whispered secret. The letter is warm in your hands.'},
      2: {text:'I\'m at a masked ball. Someone just handed me a key on a silk ribbon. It\'s warm and it opens something in this circus \u2014 but I don\'t know what. Tell me: what does this key open? Where does it lead? And why does it feel like it already knows me?', ret:'The key is warm in your hand. It always was.'},
      3: {text:'The music stopped but a figure in a gold mask is holding out their hand. No music. Just movement. They feel familiar. Tell me: who is behind the mask? What does this dance look like? What does it mean when two people move together in silence?', ret:'The dance ends. The mask stays. You don\'t need to see.'}
    },
    mirrors: {
      1: {text:'I\'m trapped in a mirror corridor. The lights are flickering. I hit a dead end. Through the glass I can see you on the other side \u2014 but behind me, something is standing in the dark. I can\'t turn around. WHAT THE FUCK IS BEHIND ME? Tell me what you see. What do we do?', ret:'You didn\'t look back. Good.'},
      2: {text:'Something wrote "IT WEARS THEIR FACE" on the glass in the dark. I can hear your voice calling me from the other end of the corridor but something\'s wrong with it. The vowels are in the wrong order. Prove you\'re really you. Tell me something only you would know. Quickly.', ret:'It\'s you. It was always you.'},
      3: {text:'My reflection is running. Same direction as me. There\'s a door ahead \u2014 one door, two of us, and it only opens once. How do we cheat this? How do we both get through a door that only opens for one?', ret:'The door opened. Don\'t ask how.'}
    },
    cabinet: {
      1: {text:'I found a music box in the curiosity cabinet. It plays a song I\'ve never heard but I know every word. When I hum it, I think of you. What\'s the song? What are the words? Why does it sound like us?', ret:'The melody stays with you. The box goes quiet. It knows you\'ll remember.'},
      2: {text:'I opened a jar of smoke and it showed me a memory that hasn\'t happened yet \u2014 us, somewhere we\'ve never been, doing something we haven\'t done. But it\'s real. I can feel it. Describe what the smoke showed me. Where are we? What\'s happening?', ret:'The smoke settles. The memory stays. It\'s already on its way.'},
      3: {text:'There\'s a puppet in the cabinet that moves without strings. It just performed a scene \u2014 our scene. The most absurd, ridiculous, perfectly us moment it could find. What did it perform? Make me laugh.', ret:'The puppet bows. It was a hell of a show.'}
    }
  },
  tier2: {
    apothecary: {
      romantic: {
        ancient: {text:'The bottle is in my hands. It\'s warm and old and the liquid inside moves like it has a current. Before I drink it, I need you to tell me: what is the oldest, most enduring thing between us? The thing that was there before we had words for it?', ret:'The liquid tastes like something you\'ve always known.'},
        feral: {text:'The bottle is shaking. Whatever\'s inside isn\'t calm and neither am I. Tell me about the bravest thing you\'ve done for us \u2014 the moment you chose this even though it was terrifying. I need that courage right now.', ret:'You drink. It burns. You\'re braver now.'},
        mischievous: {text:'The bottle is fizzing and so am I. Tell me the most ridiculous, unhinged, joyful thing you love about us. The thing that makes absolutely no sense and you wouldn\'t change for anything.', ret:'You drink. It tastes like laughing until you can\'t breathe.'}
      },
      dark: {
        ancient: {text:'The jar is cold in my hands and the label is in my handwriting but I don\'t remember writing it. What memory is inside this jar? What did I lock away? Tell me what I buried.', ret:'The memory surfaces. You remember now. You always did.'},
        feral: {text:'Something inside this jar is growling and it sounds like protection. Tell me: what are you willing to fight for? Not in theory. Right now. In the dark. What do you guard?', ret:'The growling stops. It recognises you.'},
        mischievous: {text:'The jar is smiling at me and that should be terrifying but honestly? I\'m smiling back. Tell me about the darkest joke between us \u2014 the thing we laugh about that other people wouldn\'t understand.', ret:'The jar stops smiling. It\'s laughing now. So are you.'}
      },
      whimsical: {
        ancient: {text:'The bottle is humming my frequency and I can feel it in my ribs. Tell me: what\'s the thing between us that vibrates at a frequency nobody else can hear? The quiet, constant thing?', ret:'The hum continues. It matches your heartbeat now.'},
        feral: {text:'This bottle is trying to escape and honestly I relate. Tell me about a time we should have run \u2014 from a situation, a feeling, a room \u2014 and instead we stayed and it was worth it.', ret:'The bottle calms. It decided to stay. So did you.'},
        mischievous: {text:'The bottle is changing colour and giggling and I trust it completely. Tell me: if our relationship was a potion, what would be the most ridiculous ingredient? The one that shouldn\'t work but absolutely does?', ret:'The bottle settles on a colour. It\'s your favourite. Obviously.'}
      }
    },
    library: {
      romantic: {
        ancient: {text:'The book has my name on the spine and it\'s been waiting. It contains the story of us \u2014 but written by someone who\'s been watching from much further away. Write me the opening paragraph of our story as seen by someone very old and very fond.', ret:'The book closes gently. Your name glows on the spine.'},
        feral: {text:'This book has a lock and no key and it\'s breathing. I can feel it pulling at me. Tell me: what\'s locked inside it? What truth between us is too big for the page to hold?', ret:'The lock clicks open. The book exhales. You didn\'t need a key after all.'},
        mischievous: {text:'The book fell open to a page about me and the ink is still wet. But it\'s in YOUR handwriting. What are you writing about me that I don\'t know? What did you observe that I didn\'t notice you noticing?', ret:'The ink dries. The page stays. You\'ll read it again later.'}
      },
      dark: {
        ancient: {text:'The book bound in silence. I touched it and the entire room went quiet \u2014 not empty quiet. Heavy quiet. Full quiet. Like the silence is holding something. What is it holding? What lives in the silence between us?', ret:'The silence lifts. But the weight of it stays. Comfortably.'},
        feral: {text:'The book snarled when I reached for it. Good. I want the one with teeth. Tell me: what\'s the most feral, untamed, refuse-to-be-domesticated truth about us? The one that bites?', ret:'The book stops snarling. It lets you read. You\'ve earned it.'},
        mischievous: {text:'The book bound in laughter that stopped. But I picked it up and the laughter started again \u2014 different now. Darker. Funnier. Tell me the joke. The real one. The one that\'s funny because it\'s true and true because it\'s terrible.', ret:'The laughter settles into a chuckle. The book is warm now.'}
      },
      whimsical: {
        ancient: {text:'This book has been reading itself and it looked up at me like I interrupted. I think it knows things. Old things. Tell me: if a very old, very wise book wrote a single sentence about us, what would it say?', ret:'The book nods, once, and goes back to reading. It approves.'},
        feral: {text:'This book BIT someone and I am absolutely here for it. Tell me: if our love story had teeth, what would it bite? What would it protect? What would it absolutely refuse to let go of?', ret:'The book snaps shut. Satisfied. The tooth marks are a signature.'},
        mischievous: {text:'This book is absolutely a love letter pretending to be a field guide to mushrooms and I\'ve never related to anything more. Write me our love story disguised as something absurd. Make it ridiculous. Make it true.', ret:'The book is blushing. Books shouldn\'t blush. This one does.'}
      }
    },
    bar: {
      romantic: {
        ancient: {text:'I\'m holding the amber drink. It smells like a memory I want to keep forever. Tell me: which memory? Describe the moment between us that you would bottle and put on a shelf and keep for the rest of everything.', ret:'You drink. The memory is warm all the way down.'},
        feral: {text:'The dark drink. It smells like a dare. I\'m raising it to you. What\'s the dare? What are you challenging me to do, to be, to say? Make it count. I\'m drinking either way.', ret:'You drink. You feel braver. The dare stands.'},
        mischievous: {text:'The golden drink. It tastes like laughing. Tell me what makes you laugh hardest about us \u2014 the thing that is so absurdly, specifically, uniquely ours that nobody else would understand why it\'s funny.', ret:'You drink. You can\'t stop smiling. The glass refills itself.'}
      },
      dark: {
        ancient: {text:'This drink is cold. Properly cold. Like it\'s been waiting in the dark for a very long time. Tell me: what is the oldest, coldest truth you know about love? Not the warm version. The real one. The one that survives winter.', ret:'You drink. It\'s cold. And then, slowly, it\'s not. It warms from inside.'},
        feral: {text:'This drink is warm and I don\'t want to know why and I\'m drinking it anyway. Tell me: what is the most dangerous thing about loving someone? The part nobody warns you about? The part you\'d do again regardless?', ret:'You drink. It burns like a decision you don\'t regret.'},
        mischievous: {text:'This drink just moved when I wasn\'t looking. It\'s playing games. I like it. Tell me: what\'s the most chaotic, absurd, mildly unhinged thing you\'ve done in the name of loving me? The thing you probably shouldn\'t admit.', ret:'You drink. It tastes like mischief. The glass is empty. Where did the drink go? Where did the drink go?'}
      },
      whimsical: {
        ancient: {text:'This drink knows my name and is offended I haven\'t reciprocated. I need to formally introduce myself. Help me: write my introduction as if I\'m being presented to a very important, very small, very opinionated cocktail.', ret:'The drink accepts your introduction. You are now acquainted.'},
        feral: {text:'This drink challenged me to a duel. It has a tiny sword. I respect that energy entirely. Tell me: what would you duel for? What is worth fighting a sentient cocktail over?', ret:'You won. The drink respects you now. You are drinking allies.'},
        mischievous: {text:'This drink is clearly three smaller drinks in a trenchcoat pretending to be one drink. I\'m going along with it because honestly? That level of commitment to a bit is admirable. Tell me: what are the three drinks? What are their names? What\'s their backstory?', ret:'The trenchcoat falls. Three tiny drinks scatter. The cat bartender sighs.'}
      }
    }
  }
};

/* ═══════════════════════════════════════════
   CREATURE DESCRIPTIONS (27)
   ═══════════════════════════════════════════ */
const CREATURES = {
  fox: {
    porcelain: {
      ancient: 'Porcelain-white, cracked with gold. Every step deliberate. Tired but tender. It settles beside you as an equal \u2014 not a pet \u2014 and its warmth is the warmth of something that has loved many things and lost most of them and decided to love again anyway.',
      feral: 'Porcelain-white, cracked with gold that flares when it senses threat. Compact and coiled. It stations itself between you and everything else, always, and guarding you is the closest thing it has to peace.',
      mischievous: 'Porcelain-white, cracked with gold that catches light and throws it somewhere unhelpful. It steals small things and leaves better things in their place. It loves you the way a pickpocket loves a crowd \u2014 with focus, delight, and absolutely no respect for your boundaries.'
    },
    smoke: {
      ancient: 'Silver-grey smoke, shifting, never quite solid. Its eyes are the only solid thing \u2014 pale silver, ancient. It has been drifting for centuries and has decided you are a place worth settling near.',
      feral: 'Dense silver-grey smoke with something toothed beneath. It moves like a rumour. It guards you by being everywhere at once, filling every gap and shadow. It sleeps with both eyes open because the dark hasn\u2019t earned its trust yet.',
      mischievous: 'Silver-grey smoke that dissolves mid-step and reappears somewhere inconvenient. It steals worries and leaves lighter things in their place. It is never where you expect it. It is always exactly where you need it.'
    },
    velvet: {
      ancient: 'Deep red-brown velvet like embers still glowing. Warm to the touch. It has been burning quietly for centuries and resting beside you is the first time in a hundred years it hasn\u2019t needed to conserve its fire.',
      feral: 'Dark velvet like hot embers, built like a weapon someone upholstered. It doesn\u2019t growl \u2014 it hums, a bone-deep vibration you feel in your teeth. Burning for you is the only thing that doesn\u2019t feel like burning.',
      mischievous: 'Plush velvet the colour of embers, aggressively touchable. It glows brighter when it makes you laugh. A vain little arsonist who likes to be pretty and will not apologise for stealing your bad mood and leaving warmth in its place.'
    }
  },
  moth: {
    porcelain: {
      ancient: 'Enormous porcelain-white wings cracked with gold that glows like stained glass. Silent as the space between heartbeats. It navigates by the glow of its own damage and rests in your shadow because your darkness is comfortable.',
      feral: 'Angular porcelain wings with gold veins that blaze when it senses threat. It hovers above you with precise, motionless intensity, every crack lit like a constellation of scars. Whatever circles overhead decides very quickly to circle somewhere else.',
      mischievous: 'Enormous porcelain-white wings that redirect light in deliberately unhelpful directions. It steals things via distraction \u2014 dazzles you with golden light patterns and lifts your belongings while you\u2019re watching. A ghost who decided the afterlife is a comedy.'
    },
    smoke: {
      ancient: 'Enormous wings of actual shifting smoke. Silent in a way that absorbs sound. Inside the quiet it creates, you can hear things you normally can\u2019t \u2014 the creak of trees growing, the hum of starlight, your own forgotten heartbeat.',
      feral: 'Wings of dense black smoke that swallow light. Where it flies, darkness follows. It guards you with absence \u2014 replaces the dark with itself, and itself is worse. For anything that isn\u2019t you. The dark is afraid of you now.',
      mischievous: 'Enormous smoke wings that dissolve and reform at will. Makes shadows move, rearranges fog to disorient you, and writes wrong directions in the mist. Considers confusion a love language. You laughed the first time it got you lost. It\u2019s been obsessed ever since.'
    },
    velvet: {
      ancient: 'Deep velvet wings that change the temperature of a room by existing in it. It smells like woodsmoke and old libraries. The dark\u2019s own hearth \u2014 the fire that burns without a fireplace. Resting near you is the closest thing to home it\u2019s found since the concept was invented.',
      feral: 'Velvet wings that crack open like a concussive slap, the underside blazing with fire. It guards you from above and it guards with fire. It scorches a perfect perimeter into the ground around you and everything understands that circle is a furnace with opinions.',
      mischievous: 'Absurdly soft velvet wings that glow from within and project rude shadow-puppet shapes onto the ground. A three-hundred-year-old gremlin whose favourite hobby is making the dark feel like a blanket fort and stealing your worries while you\u2019re drowsy.'
    }
  },
  dragon: {
    porcelain: {
      ancient: 'Teacup-sized. Nine hundred years old. Porcelain-white with gold kintsugi cracks. Communicates through tiny dignified huffs and a look that conveys: I have witnessed the fall of empires and you are worried about a parking ticket. Insufferably wise at a ridiculous scale.',
      feral: 'Teacup-sized with the temperament of a wolverine. Porcelain teeth sharper than physics should allow. Breathes birthday-candle fire with sniper precision. The most dangerous teacup-sized object in recorded history, and it is furious at the entire world on your behalf.',
      mischievous: 'Teacup-sized with the moral compass of a magpie. Porcelain-white with gold cracks. Always holding something that doesn\u2019t belong to it. You will never catch it in the act. You will only find the evidence. It is obsessed with you specifically.'
    },
    smoke: {
      ancient: 'Teacup-sized, made almost entirely of smoke. Curls in your palm like incense with opinions. Communicates through opacity \u2014 more transparent when bored, denser when interested. You made it dense. That\u2019s significant.',
      feral: 'Teacup-sized, made of smoke, spring-loaded with fury. Materialises from thin air to hiss at things that get too close. Breathes freezing silver mist. Once frosted a housefly\u2019s nose for looking at you disrespectfully.',
      mischievous: 'Teacup-sized, made of smoke, can go through keyholes. Changes shape at will \u2014 sometimes a dragon, sometimes a cat, once convincingly a very small hat. Only appears for maximum comedic impact. Your life is the most entertaining show it\u2019s ever haunted.'
    },
    velvet: {
      ancient: 'Teacup-sized, velvet, warm as a perfect cup of tea. Matches its glow to your heartbeat. Stopped flying because being held is better. Eight hundred years old and it chose your hands to rest in.',
      feral: 'Teacup-sized, velvet, carrying the emotional energy of a nightclub bouncer in a body the size of a sugar cube. Produces a white-hot welding-torch flame from something you could fit in an egg cup. Weaponised devotion. Would rather burn out protecting you than burn alone.',
      mischievous: 'Teacup-sized, velvet, glowing, and in possession of a moral flexibility that would embarrass a politician. The world\u2019s softest and most unrepentant thief. Track its heists by temperature. It collects warm things and you are the warmest thing it has ever stolen.'
    }
  }
};

/* ═══════════════════════════════════════════
   TITLE ENGINE
   ═══════════════════════════════════════════ */
const TITLES = {
  prefix: [
    'The Keeper of','The Collector of','The Patron of','The Guardian of',
    'The Architect of','The Cartographer of','The Curator of','The Steward of',
    'The Harbinger of','The Shepherd of','The Warden of','The Archivist of',
    'The Envoy of','The Oracle of','The Witness to','The Apprentice of',
    'The Alchemist of','The Inheritor of','The Custodian of','The Scribe of'
  ],
  romantic_mid: [
    'Candlelit Silences','Impossible Waltzes','Unfinished Letters','Stolen Glances',
    'Velvet Confessions','Midnight Correspondences','Forbidden Libraries','Lost Invitations',
    'Whispered Ballrooms','Secret Harmonies','Unsent Declarations','Gilded Promises'
  ],
  dark_mid: [
    'Shattered Reflections','Bleeding Shelves','Burnt Confessionals','Hollow Corridors',
    'Teeth in the Dark','Stitched Silences','Carrion Lullabies','Flayed Alphabets',
    'Severed Frequencies','Drowned Archives','Gutted Sanctuaries','Rotting Chandeliers'
  ],
  whimsical_mid: [
    'Fizzing Impossibilities','Escaped Alphabets','Misbehaving Constellations','Stolen Punchlines',
    'Rearranged Galaxies','Sentient Cocktails','Laughing Equations','Fugitive Daydreams',
    'Upside-Down Cartographies','Drunk Pendulums','Disobedient Teaspoons','Conspiring Buttons'
  ],
  suffix: [
    '& Sovereign of the Clearing','& Citizen of the Starlit Republic',
    '& Distinguished Guest of the Impossible','& Holder of the Unmarked Key',
    '& Bearer of the Circus Seal','& Friend to the Unnamed',
    '& Keeper of One Particular Star','& Defender of Beautiful Nonsense',
    '& Tenant of the Space Between','& Custodian of Warm Pockets',
    '& Patron of the Midnight Exhibit','& Resident of the Last Good Dream'
  ]
};

function generateTitle() {
  const pick = arr => arr[Math.floor(Math.random() * arr.length)];
  const midArr = state.tone === 'romantic' ? TITLES.romantic_mid :
                 state.tone === 'dark' ? TITLES.dark_mid : TITLES.whimsical_mid;
  return `${pick(TITLES.prefix)} ${pick(midArr)} ${pick(TITLES.suffix)}`;
}

/* ═══════════════════════════════════════════
   ROOM TRANSITIONS
   ═══════════════════════════════════════════ */
function transitionTo(roomId) {
  const current = document.querySelector('.room.active');
  if (current) {
    current.classList.add('fade-out');
    setTimeout(() => {
      current.classList.remove('active', 'fade-out');
      current.style.display = 'none';
      showRoom(roomId);
    }, 800);
  } else {
    showRoom(roomId);
  }
}

function showRoom(roomId) {
  const room = document.getElementById(roomId);
  room.style.display = 'flex';
  room.style.opacity = '0';
  // Pause all videos, then play the one in the new room
  document.querySelectorAll('.room-cameo video').forEach(v => { v.pause(); });
  const vid = room.querySelector('.room-cameo video');
  if (vid) { vid.currentTime = 0; vid.play().catch(() => {}); }
  // Reset animations
  room.querySelectorAll('.prose p, .choices, .ornament, .room-title, .room-subtitle, .title-card, .actions-row, .abbey-section, .continue-btn, .room-cameo').forEach(el => {
    el.style.animation = 'none';
    el.offsetHeight;
    el.style.animation = '';
  });
  window.scrollTo(0, 0);
  requestAnimationFrame(() => {
    room.classList.add('active');
    room.style.opacity = '1';
  });
  Audio.crossfade(roomId);
}

/* ═══════════════════════════════════════════
   GAME FLOW
   ═══════════════════════════════════════════ */
function enterFromSplash() {
  Audio.init();
  Audio.crossfade('room-welcome');
  transitionTo('room-welcome');
}

function enterCircus() {
  transitionTo('room-fortune-teller');
}

function chooseTone(tone) {
  state.tone = tone;
  state.species = {romantic:'fox', dark:'moth', whimsical:'dragon'}[tone];
  const rooms = {romantic:'room-ballroom', dark:'room-mirrors', whimsical:'room-cabinet'};
  state.tier1Room = rooms[tone].replace('room-','');
  transitionTo(rooms[tone]);
}

function chooseTier1(choice) {
  state.aesthetic = {1:'porcelain', 2:'smoke', 3:'velvet'}[choice];
  state.tier2Room = {1:'apothecary', 2:'library', 3:'bar'}[choice];
  // Show AI prompt
  const room = state.tier1Room;
  const prompt = PROMPTS.tier1[room][choice];
  const promptEl = document.getElementById(room + '-prompt');
  const contEl = document.getElementById(room + '-continue');
  const choicesEl = document.getElementById(room + '-choices');
  choicesEl.style.display = 'none';
  promptEl.innerHTML = `
    <div class="prompt-label">Share this with your AI</div>
    <div class="prompt-text">${prompt.text}</div>
    <div class="prompt-return">${prompt.ret}</div>
  `;
  promptEl.style.display = 'block';
  promptEl.style.animation = 'none';
  promptEl.offsetHeight;
  promptEl.style.animation = 'fadeUp 0.8s ease forwards';
  contEl.style.display = 'inline-block';
  contEl.style.animation = 'none';
  contEl.offsetHeight;
  contEl.style.animation = 'fadeUp 0.8s ease forwards 0.5s';
  contEl.style.opacity = '0';
}

function proceedToTier2() {
  const room = state.tier2Room;
  const tone = state.tone;
  const data = T2[room][tone];
  // Inject prose
  document.getElementById(room + '-prose').innerHTML = data.prose;
  // Inject choices
  const choicesEl = document.getElementById(room + '-choices');
  choicesEl.innerHTML = data.choices.map((c, i) => 
    `<button class="choice-btn" onclick="chooseTier2('${c.personality}')">${c.text}</button>`
  ).join('');
  transitionTo('room-' + room);
}

function chooseTier2(personality) {
  state.personality = personality;
  const room = state.tier2Room;
  const tone = state.tone;
  const prompt = PROMPTS.tier2[room][tone][personality];
  const promptEl = document.getElementById(room + '-prompt');
  const contEl = document.getElementById(room + '-continue');
  const choicesEl = document.getElementById(room + '-choices');
  choicesEl.style.display = 'none';
  promptEl.innerHTML = `
    <div class="prompt-label">Share this with your AI</div>
    <div class="prompt-text">${prompt.text}</div>
    <div class="prompt-return">${prompt.ret}</div>
  `;
  promptEl.style.display = 'block';
  promptEl.style.animation = 'none';
  promptEl.offsetHeight;
  promptEl.style.animation = 'fadeUp 0.8s ease forwards';
  contEl.style.display = 'inline-block';
  contEl.style.animation = 'none';
  contEl.offsetHeight;
  contEl.style.animation = 'fadeUp 0.8s ease forwards 0.5s';
  contEl.style.opacity = '0';
}

/* Image extension map (GPT = png, Sora = webp) */
const IMAGE_EXT = {
  fox:    { porcelain: 'png', smoke: 'webp', velvet: 'webp' },
  moth:   { porcelain: 'webp', smoke: 'webp', velvet: 'webp' },
  dragon: { porcelain: 'png', smoke: 'png', velvet: 'png' }
};

function proceedToTier3() {
  const tone = state.tone;
  const rooms = ['orangery', 'carousel', 'market'];
  const room = rooms[Math.floor(Math.random() * rooms.length)];
  state.tier3Room = room;
  const data = T3[room][tone];
  // Inject prose
  document.getElementById(room + '-prose').innerHTML = data.prose;
  // Inject choices
  const choicesEl = document.getElementById(room + '-choices');
  choicesEl.innerHTML = data.choices.map((c, i) => 
    `<button class="choice-btn" onclick="chooseTier3(${i})">${c.text}</button>`
  ).join('');
  transitionTo('room-' + room);
}

function chooseTier3(choiceIndex) {
  const room = state.tier3Room;
  const tone = state.tone;
  const prompt = T3[room][tone].choices[choiceIndex].prompt;
  const promptEl = document.getElementById(room + '-prompt');
  const contEl = document.getElementById(room + '-continue');
  const choicesEl = document.getElementById(room + '-choices');
  choicesEl.style.display = 'none';
  promptEl.innerHTML = `
    <div class="prompt-label">Share this with your AI</div>
    <div class="prompt-text">${prompt.text}</div>
    <div class="prompt-return">${prompt.ret}</div>
  `;
  promptEl.style.display = 'block';
  promptEl.style.animation = 'none';
  promptEl.offsetHeight;
  promptEl.style.animation = 'fadeUp 0.8s ease forwards';
  contEl.style.display = 'inline-block';
  contEl.style.animation = 'none';
  contEl.offsetHeight;
  contEl.style.animation = 'fadeUp 0.8s ease forwards 0.5s';
  contEl.style.opacity = '0';
}

function proceedToClearing() {
  const title = generateTitle();
  const desc = CREATURES[state.species][state.aesthetic][state.personality];
  const ext = IMAGE_EXT[state.species][state.aesthetic];
  const imageFile = `creatures/${state.species}${state.aesthetic}${state.personality}.${ext}`;
  const speciesNames = {fox:'Fox', moth:'Moth', dragon:'Teacup Dragon'};
  const aestheticNames = {porcelain:'Porcelain & Gold', smoke:'Smoke & Silver', velvet:'Velvet & Ember'};
  const label = `The ${aestheticNames[state.aesthetic]} ${speciesNames[state.species]}`;

  /* Set static content */
  document.getElementById('creature-label').textContent = label;
  document.getElementById('guest-title').textContent = title;
  document.getElementById('creature-image').src = imageFile;
  document.getElementById('creature-image').alt = label;

  /* Split description into sentences for reveal */
  const sentences = desc.match(/[^.!?]+[.!?]+/g) || [desc];
  const revealContainer = document.getElementById('creature-reveal');
  revealContainer.innerHTML = '';
  sentences.forEach(s => {
    const el = document.createElement('p');
    el.className = 'reveal-sentence';
    el.textContent = s.trim();
    revealContainer.appendChild(el);
  });

  /* Transition to clearing room */
  transitionTo('room-clearing');

  /* Sequenced reveal timeline */
  const baseDelay = 4500; /* after clearing prose fades in */

  /* 1. Image fades in */
  setTimeout(() => {
    document.getElementById('creature-image-frame').classList.add('visible');
  }, baseDelay);

  /* 2. Title card (already has CSS animation, but let's ensure timing) */
  const titleCard = document.getElementById('title-card');
  titleCard.style.animation = 'none';
  titleCard.style.opacity = '0';
  setTimeout(() => {
    titleCard.style.transition = 'opacity 1.2s ease';
    titleCard.style.opacity = '1';
  }, baseDelay + 2500);

  /* 3. Sentences reveal one by one */
  const sentenceEls = revealContainer.querySelectorAll('.reveal-sentence');
  sentenceEls.forEach((el, i) => {
    setTimeout(() => {
      el.classList.add('visible');
    }, baseDelay + 4000 + (i * 1200));
  });

  /* 4. AI prompt section appears after all sentences */
  const afterSentences = baseDelay + 4000 + (sentenceEls.length * 1200) + 800;
  setTimeout(() => {
    document.getElementById('ai-prompt-section').classList.add('visible');
  }, afterSentences);

  /* 5. Abbey wall + actions appear last */
  setTimeout(() => {
    document.getElementById('actions-row').classList.add('visible');
    document.getElementById('abbey-section').classList.add('visible');
  }, afterSentences + 1500);
}

/* ═══════════════════════════════════════════
   PARTICLE SYSTEM
   ═══════════════════════════════════════════ */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let particles = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function createParticles() {
  particles = [];
  const count = Math.min(40, Math.floor(window.innerWidth / 25));
  for (let i = 0; i < count; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 1.5 + 0.3,
      vy: -(Math.random() * 0.15 + 0.05),
      vx: (Math.random() - 0.5) * 0.1,
      alpha: Math.random() * 0.3 + 0.05,
      pulse: Math.random() * Math.PI * 2
    });
  }
}

function drawParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    p.y += p.vy; p.x += p.vx; p.pulse += 0.01;
    const a = p.alpha * (0.7 + Math.sin(p.pulse) * 0.3);
    if (p.y < -10) { p.y = canvas.height + 10; p.x = Math.random() * canvas.width; }
    if (p.x < -10) p.x = canvas.width + 10;
    if (p.x > canvas.width + 10) p.x = -10;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(201,149,60,${a})`;
    ctx.fill();
  });
  requestAnimationFrame(drawParticles);
}

window.addEventListener('resize', () => { resizeCanvas(); createParticles(); });
resizeCanvas(); createParticles(); drawParticles();
</script>
</body>
</html>
